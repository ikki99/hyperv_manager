# Hyper-V Manager (Electron Edition) - 开发计划

## 1. 核心目标

本计划旨在将现有的 Hyper-V 管理器项目重构并完善为一个功能强大、界面现代、易于使用的桌面应用程序。我们将使用 Electron、HTML、CSS 和 JavaScript 技术栈，并深度集成 PowerShell 以实现所有后端功能。

## 2. 技术栈

- **核心框架:** Electron
- **前端:** HTML5, CSS3, JavaScript (ES6+)
- **UI/UX:** Bootstrap 5 (用于快速构建现代化响应式布局), FontAwesome (用于图标)
- **后端:** Node.js (Electron Main Process)
- **Hyper-V 交互:** PowerShell

## 3. 开发任务分解

### 任务 1: 基础架构重构与 UI 现代化 (第一阶段)

-   [ ] **1.1. 安全加固:**
    -   在 `main.js` 中设置 `contextIsolation: true` 和 `nodeIntegration: false`。
    -   重构 `preload.js`，使用 `contextBridge` 安全地将 `ipcRenderer` 功能暴露给渲染进程。这将是所有后续功能开发的基础。
-   [ ] **1.2. 引入 Bootstrap 5:**
    -   下载或使用 CDN 引入 Bootstrap 5 CSS 和 JS。
    -   更新 `index.html` 以使用 Bootstrap 的栅格系统和组件。
-   [ ] **1.3. 设计新的应用布局:**
    -   创建一个主布局，包含一个固定的侧边栏导航和一个主内容区域。
    -   侧边栏将用于在不同功能页面（虚拟机、网络、镜像等）之间切换。
-   [ ] **1.4. 页面路由:**
    -   实现一个简单的前端路由机制，根据侧边栏的点击，在主内容区域加载不同的 HTML 页面或内容片段。

### 任务 2: 核心功能实现 (第二阶段)

-   [ ] **2.1. 虚拟机管理页面 (`vms.html`):**
    -   重新设计虚拟机列表，使用 Bootstrap 的 `table` 和 `card` 组件。
    -   列表显示核心信息（名称、状态、CPU、内存）。
    -   点击列表项时，在旁边或下方显示该虚拟机的详细信息卡片（包括 IP 地址、运行时间、操作系统等）。
    -   实现并测试虚拟机操作按钮（启动、关闭、保存、强制停止、连接）。
-   [ ] **2.2. 网络管理页面 (`network.html`):**
    -   创建 UI 以列表形式展示所有虚拟交换机 (`Get-VMSwitch`)。
    -   实现创建新的虚拟交换机（Internal, External, Private）的模态框表单。
    -   实现删除虚拟交换机的功能。
    -   **(高级)** 为 NAT 交换机提供一个独立的标签页或区域来管理端口转发规则。
-   [ ] **2.3. 镜像管理页面 (`images.html`):**
    -   创建 UI，包含两个标签页：“本地镜像”和“在线仓库”。
    -   **本地镜像:**
        -   提供一个设置项，让用户指定本地 `.iso` 文件的扫描目录。
        -   实现扫描并显示本地镜像列表。
    -   **在线仓库:**
        -   读取一个在线的 JSON 文件（初期可硬编码），展示可供下载的流行操作系统镜像（如 Ubuntu, Windows Dev ISOs）。
        -   **(高级)** 实现文件下载功能，并显示下载进度。

### 任务 4: 向导式虚拟机创建 (第三阶段)

-   [ ] **4.1. 创建向导 UI:**
    -   设计一个多步骤的模态框向导 (`wizard.html`) 来引导用户完成虚拟机的创建。
    -   **步骤 1:** 名称和路径。
    -   **步骤 2:** 虚拟机代数（Generation 1/2）、内存、CPU核心数。
    -   **步骤 3:** 硬盘（创建新硬盘并指定大小，或使用现有 `.vhdx` 文件）。
    -   **步骤 4:** 网络（选择一个已存在的虚拟交换机）。
    -   **步骤 5:** 安装介质（选择一个本地 `.iso` 镜像）。
    -   **步骤 6:** 摘要和确认。
-   [ ] **4.2. 实现创建逻辑:**
    -   在 `powershell-service.js` 中创建一个 `createVM` 的复杂函数，根据向导收集的参数构建并执行 `New-VM` 及相关的 PowerShell 命令。
    -   在主进程中处理来自向导的 IPC 请求。
    -   提供创建过程的实时反馈（例如，在界面上显示“正在创建硬盘...”、“正在配置网络...”）。

### 任务 5: 测试、打包与收尾 (第四阶段)

-   [ ] **5.1. 错误处理和日志记录:**
    -   在 UI 中添加一个全局的通知/警报组件，用于显示来自 PowerShell 的成功或错误消息。
-   [ ] **5.2. 单元测试:**
    -   为 `powershell-service.js` 中的关键、无副作用的函数编写单元测试。
-   [ ] **5.3. 打包配置:**
    -   引入 `electron-builder`。
    -   配置 `package.json` 以支持一键打包为 Windows 可执行文件 (`.exe`)。
-   [ ] **5.4. 应用图标和元数据:**
    -   为应用创建并配置一个新图标。
    -   完善 `package.json` 中的应用元数据（作者、描述等）。

---
**项目管理:** 我将按照上述任务顺序，逐一完成开发和测试。每个任务完成后，我会向您报告进度。
