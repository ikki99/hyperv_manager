<Page
    x:Class="HyperVManager.Views.ImagesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:models="using:HyperVManager.Models"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <TextBlock Text="系统镜像管理" FontSize="24" Margin="10"/>
        <Pivot Grid.Row="1">
            <PivotItem Header="在线镜像市场">
                <ScrollViewer>
                    <StackPanel Spacing="10" Margin="10">
                        <TextBlock Text="提示: 点击按钮后将在外部浏览器打开下载页面，您可以使用第三方下载工具。" FontSize="12" Foreground="Gray"/>
                        <ItemsRepeater x:Name="OnlineImagesRepeater" ItemsSource="{x:Bind OnlineImages, Mode=OneWay}">
                            <ItemsRepeater.Layout>
                                <StackLayout Orientation="Horizontal" Spacing="10"/>
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="models:OnlineImage">
                                    <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="4" Padding="10" Width="250">
                                        <StackPanel Spacing="5">
                                            <TextBlock Text="{x:Bind Name}" FontSize="16" FontWeight="Bold"/>
                                            <TextBlock Text="{x:Bind Version}" FontSize="14"/>
                                            <TextBlock Text="{x:Bind Size}" FontSize="14"/>
                                            <TextBlock Text="{x:Bind Description}" TextWrapping="Wrap" Height="60"/>
                                            <Button Content="在浏览器中打开" Tag="{x:Bind DownloadUrl}" Click="OnOpenDownloadUrlClicked" HorizontalAlignment="Stretch"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </StackPanel>
                </ScrollViewer>
            </PivotItem>
            <PivotItem Header="本地镜像">
                <StackPanel Spacing="10" Margin="10">
                    <TextBlock Text="选择包含镜像文件的文件夹:"/>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBox x:Name="ScanPathTextBox" PlaceholderText="选择文件夹" IsReadOnly="True" Width="300"/>
                        <Button Content="浏览" Click="OnBrowseScanPathClicked"/>
                        <Button Content="开始扫描" Click="OnScanLocalClicked"/>
                    </StackPanel>
                    <controls:DataGrid x:Name="LocalImagesDataGrid"
                                       AutoGenerateColumns="False"
                                       IsReadOnly="True"
                                       HeadersVisibility="Column"
                                       ItemsSource="{x:Bind LocalImages, Mode=OneWay}">
                        <controls:DataGrid.Columns>
                            <controls:DataGridTextColumn Header="文件名" Binding="{Binding Name}" Width="*"/>
                            <controls:DataGridTextColumn Header="路径" Binding="{Binding Path}" Width="2*"/>
                            <controls:DataGridTextColumn Header="大小" Binding="{Binding Size}" Width="Auto"/>
                        </controls:DataGrid.Columns>
                    </controls:DataGrid>
                    <Button Content="使用选中镜像创建虚拟机" Click="OnCreateVMFromLocalClicked" HorizontalAlignment="Stretch"/>
                </StackPanel>
            </PivotItem>
        </Pivot>
    </Grid>
</Page>